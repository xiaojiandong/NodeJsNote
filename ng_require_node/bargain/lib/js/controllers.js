define(["base","services"],function(t,o){var e=angular.module("RouterCtrl",["RouterServices"]);e.controller("IndexCtrl",["$rootScope","$scope","$state","goodsInfoFactory",function(t,o,e,a){t.tabs=a.topTabGoodsBg,angular.forEach(t.tabs,function(t,o,e){e[0].check_name="砍价者",e[1].check_name="其他砍价团",e[2].check_name="规则声明"}),t.activeIndex=0,t.changeIndex=0,t.pageClass="tab0",t.onTabClick=function(o){t.activeIndex=o.tab_id,t.changeIndex=o.tab_id,console.log(o),t.pageClass="tab"+o.tab_id},t.actBgSrc=a.actBgSrc,t.callback=function(){console.log("倒计时结束"),$(".cut-words-tips-wrap").css("color","#999"),$(".js_now_pay_btn").show(),$(".js_start_kill_again").show()},o.onStartKillClick=function(o){window.location.href="http://127.0.0.1:8083/bargain/index.html#/index/act_down?goods_type="+o.src_id;var e="2016/7/5 17:20:20",a="2016/7/5 17:20:30";SUBJ.getCutTimeDown("js_time",e,a,t.callback)}}]),e.controller("HomeCtrl",["$rootScope","$scope",function(t,o){}]),e.controller("ActDownCtrl",["$rootScope","$scope","$timeout","goodsInfoFactory",function(t,o,e,a){var c=SUBJ.getValueFromHrefByKey("goods_type");if(t.actTopBgSrc=a.actTopBgSrc,t.actTopBgInfo=a.actTopBgSrc[c],o.isShowSuccessMask=!1,o.hasCut=!1,localStorage.getItem("goodsStatus")&&null!=localStorage.getItem("goodsStatus")&&"undefined"!=localStorage.getItem("goodsStatus")){var n=JSON.parse(localStorage.getItem("goodsStatus"));n.hasCutLocal&&($(".js_help_ta_kill").text("已砍过").css("color","#999"),t.actTopBgInfo.price=n.price,t.randomPrice=n.randomPrice,o.onHelpTaKillClick=function(){return!1})}else $(".js_help_ta_kill").text("帮ta砍价"),o.onHelpTaKillClick=function(){if(!o.hasCut){$(".js_help_ta_kill").text("已砍过").css("color","#999"),o.isShowSuccessMask=!o.isShowSuccessMask,o.randomCutPrice=parseInt(100*Math.random().toFixed(2)),t.actTopBgInfo.price-=o.randomCutPrice;var e={};e.hasCutLocal=!0,e.price=t.actTopBgInfo.price,e.randomPrice=o.randomCutPrice,t.randomPrice=e.randomPrice,localStorage.setItem("goodsStatus",JSON.stringify(e))}o.hasCut=!0};if(o.onCloseMask=function(){o.isShowSuccessMask=!o.isShowSuccessMask},o.onStopPropagationClick=function(t){var t=t||window.event;t.stopPropagation()},o.onShareFriendsClick=function(){alert("分享给好友")},o.onPayClick=function(){alert("跳转到立即付款页面，当前价格:"+o.actTopBgInfo.price)},o.onStartAgain=function(){$(".js_now_pay_btn , .js_start_kill_again").hide(),$(".js_help_ta_kill").show().text("帮ta砍价").css("color","#fff"),location.reload(),localStorage.removeItem("goodsStatus"),$(".cut-words-tips-wrap").css("color","#fff"),$(".js_time").text("开始倒计时");var t=new Date;o.bindTimeCut(t);var e=o.bindTimeCut(t).clickStartDate,a=o.bindTimeCut(t).clickEndDate,c={clickStartDate:e,clickEndDate:a};console.log("clickStartDate : "+e),console.log("clickEndDate : "+a),localStorage.setItem("dateObj",JSON.stringify(c))},localStorage.getItem("dateObj")&&null!=localStorage.getItem("dateObj")&&"undefined"!=localStorage.getItem("dateObj")){var r=JSON.parse(localStorage.getItem("dateObj"));SUBJ.getCutTimeDown("js_time",r.clickStartDate,r.clickEndDate,t.callback)}o.bindTimeCut=function(o){var e=o.getFullYear(),a=o.getMonth()+1,c=o.getDate(),n=o.getHours(),r=o.getMinutes(),s=o.getSeconds();console.log(o);var l,i,u,g,d=e+"/"+a+"/"+c+" "+n+":"+r+":"+s;g=s+11,g>=60?(g-=60,u=r+1,u>=60?(u-=60,i=n+1):(i=n,l=c)):(u=r,i=n,l=c);var _=e+"/"+a+"/"+l+" "+i+":"+u+":"+g;return SUBJ.getCutTimeDown("js_time",d,_,t.callback),dateObj={clickStartDate:d,clickEndDate:_}},console.log(a.userInfo),o.userInfos=a.userInfo,t.bindScroll=function(){var t,o,e;setTimeout(function(){t=$(".js_single_user_li").outerHeight()+15,e=$(".js_user_scroll_wrap").outerHeight()},30),setInterval(function(){$(".js_user_scroll_wrap").position()&&"undefined"!=$(".js_user_scroll_wrap").position().top&&(o=$(".js_user_scroll_wrap").position().top,o<=-(e/2-15)?$(".js_user_scroll_wrap").css({top:"0"}):$(".js_user_scroll_wrap").animate({top:"-="+t},800))},3e3)},t.bindScroll(),o.actFilterFn=function(t){if(t.src_id!=c)return t}}])});