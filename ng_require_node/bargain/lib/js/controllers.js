define(["base","services"],function(t,o){var e=angular.module("RouterCtrl",["RouterServices"]);e.controller("IndexCtrl",["$rootScope","$scope","$state","goodsInfoFactory",function(t,o,e,a){t.tabs=a.topTabGoodsBg,angular.forEach(t.tabs,function(t,o,e){e[0].check_name="砍价者",e[1].check_name="其他砍价团",e[2].check_name="规则声明"}),t.activeIndex=0,t.changeIndex=0,t.pageClass="tab0",t.onTabClick=function(o){t.activeIndex=o.tab_id,t.changeIndex=0,console.log(o),t.pageClass="tab"+o.tab_id},o.onTabClick1=function(o){t.changeIndex=o.tab_id,console.log(o.tab_id)},t.actBgSrc=a.actBgSrc,t.callback=function(){console.log("倒计时结束"),$(".cut-words-tips-wrap").css("color","#999"),$(".js_now_pay_btn").show(),$(".js_start_kill_again").show()},t.onStartKillClick=function(o){localStorage.getItem("goodsStatus")&&localStorage.removeItem("goodsStatus"),localStorage.getItem("dateObj")&&location.reload(),window.location.href="http://127.0.0.1:8083/bargain/index.html#/index/act_down?goods_type="+o.src_id;var e="2016/7/7 17:20:20",a="2016/7/7 17:20:30";SUBJ.getCutTimeDown("js_time",e,a,t.callback)};var c=$(window).height();$(window).on("scroll",function(){var o=$(window).scrollTop();o>c?(t.isShowReturn=!0,$(".js_return_top_btn").show()):$(".js_return_top_btn").hide()}),t.onReturnTopClick=function(){var t=null;t=setInterval(function(){var o=$(window).scrollTop();o=(o/1.3).toFixed(2),o<1&&(o=Math.floor(o)),o<=0&&clearInterval(t),$(window).scrollTop(o)},30)}}]),e.controller("HomeCtrl",["$rootScope","$scope",function(t,o){}]),e.controller("ActDownCtrl",["$rootScope","$scope","$timeout","goodsInfoFactory",function(t,o,e,a){var c=SUBJ.getValueFromHrefByKey("goods_type");t.actTopBgSrc=a.actTopBgSrc,t.actTopBgInfo=a.actTopBgSrc[c],o.isShowSuccessMask=!1,o.hasCut=!1,t.randomPrice=0;var l,r=0;if(localStorage.getItem("cutKillTime_"+c)&&null!=localStorage.getItem("cutKillTime_"+c)&&"undefined"!=localStorage.getItem("cutKillTime_"+c)?(l=JSON.parse(localStorage.getItem("cutKillTime_"+c)),l=parseInt(l),r=l+1):r+=1,localStorage.getItem("goodsStatus")&&null!=localStorage.getItem("goodsStatus")&&"undefined"!=localStorage.getItem("goodsStatus")){var n=JSON.parse(localStorage.getItem("goodsStatus"));n.hasCutLocal&&($(".js_help_ta_kill").text("已砍过").css("color","#999"),t.actTopBgInfo.price=n.price,t.randomPrice=n.randomPrice,o.onHelpTaKillClick=function(){return!1})}else $(".js_help_ta_kill").text("帮TA砍价"),o.onHelpTaKillClick=function(){if(!o.hasCut){localStorage.setItem("cutKillTime_"+c,JSON.stringify(r));var e=JSON.parse(localStorage.getItem("cutKillTime_"+c));if(console.log("砍的次数cut："+l),e>3)alert(t.actTopBgInfo.actName+" 已经砍了3次了，不能再砍了");else{$(".js_help_ta_kill").text("已砍过").css("color","#999"),o.isShowSuccessMask=!o.isShowSuccessMask,o.randomCutPrice=parseInt(100*Math.random().toFixed(2)),t.actTopBgInfo.price-=o.randomCutPrice;var a={};a.hasCutLocal=!0,a.price=t.actTopBgInfo.price,a.randomPrice=o.randomCutPrice,t.randomPrice=a.randomPrice,localStorage.setItem("goodsStatus",JSON.stringify(a)),o.leaveCutTime=3-e;var n={};0==c?n.shoulian={final_price:t.actTopBgInfo.price,cut_price:o.randomCutPrice}:1==c?n.shuiguang={final_price:t.actTopBgInfo.price,cut_price:o.randomCutPrice}:n.jiguang={final_price:t.actTopBgInfo.price,cut_price:o.randomCutPrice},localStorage.setItem("lastGoodsInfo_"+c,JSON.stringify(n))}}o.hasCut=!0};if(localStorage.getItem("lastGoodsInfo_"+c)&&null!=localStorage.getItem("lastGoodsInfo_"+c)&&"undefined"!=localStorage.getItem("lastGoodsInfo_"+c)){var l=JSON.parse(localStorage.getItem("cutKillTime_"+c)),i=JSON.parse(localStorage.getItem("lastGoodsInfo_"+c));console.log("水光针的砍价次数"),console.log(l);var s;s=0==c?i.shoulian:1==c?i.shuiguang:i.jiguang,l>=3&&(t.actTopBgInfo.price=s.final_price,t.randomPrice=s.cut_price,$(".cut-words-tips-wrap").html(t.actTopBgInfo.actName+"的3次砍价机会已用完<br/>赶快去付款吧"),$(".cut-words-tips-wrap").css("padding-top","30px"),$(".js_help_ta_kill").hide(),$(".js_now_pay_btn").show())}if(o.onCloseMask=function(){o.isShowSuccessMask=!o.isShowSuccessMask},o.onStopPropagationClick=function(t){var t=t||window.event;t.stopPropagation()},o.onShareFriendsClick=function(){alert("分享给好友")},o.onPayClick=function(){alert("跳转到立即付款页面，当前价格:"+o.actTopBgInfo.price)},o.onStartAgain=function(){$(".js_now_pay_btn , .js_start_kill_again").hide(),$(".js_help_ta_kill").show().text("帮TA砍价").css("color","#fff"),location.reload(),localStorage.removeItem("goodsStatus"),$(".cut-words-tips-wrap").css("color","#fff"),$(".js_time").text("开始倒计时");var t=new Date;o.bindTimeCut(t);var e=o.bindTimeCut(t).clickStartDate,a=o.bindTimeCut(t).clickEndDate,c={clickStartDate:e,clickEndDate:a};console.log("clickStartDate : "+e),console.log("clickEndDate : "+a),localStorage.setItem("dateObj",JSON.stringify(c))},localStorage.getItem("dateObj")&&null!=localStorage.getItem("dateObj")&&"undefined"!=localStorage.getItem("dateObj")){var g=JSON.parse(localStorage.getItem("dateObj"));SUBJ.getCutTimeDown("js_time",g.clickStartDate,g.clickEndDate,t.callback)}o.bindTimeCut=function(o){var e=o.getFullYear(),a=o.getMonth()+1,c=o.getDate(),l=o.getHours(),r=o.getMinutes(),n=o.getSeconds();console.log(o);var i,s,g,u,d=e+"/"+a+"/"+c+" "+l+":"+r+":"+n;u=n+11,u>=60?(u-=60,g=r+1,g>=60?(g-=60,s=l+1):(s=l,i=c)):(g=r,s=l,i=c);var p=e+"/"+a+"/"+i+" "+s+":"+g+":"+u;return SUBJ.getCutTimeDown("js_time",d,p,t.callback),dateObj={clickStartDate:d,clickEndDate:p}},console.log(a.userInfo),o.userInfos=a.userInfo,t.bindScroll=function(){var t,o,e;setTimeout(function(){t=$(".js_single_user_li").outerHeight()+15,e=$(".js_user_scroll_wrap").outerHeight()},30),setInterval(function(){$(".js_user_scroll_wrap").position()&&"undefined"!=$(".js_user_scroll_wrap").position().top&&(o=$(".js_user_scroll_wrap").position().top,o<=-(e/2-15)?$(".js_user_scroll_wrap").css({top:"0"}):$(".js_user_scroll_wrap").animate({top:"-="+t},800))},3e3)},t.bindScroll(),o.actFilterFn=function(t){if(t.src_id!=c)return t}}])});